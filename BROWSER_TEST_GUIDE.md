# 🌐 ブラウザテストガイド

リアルタイムチャットアプリケーションをブラウザで実際にテストする手順です。

## 📋 事前準備

### 1. 必要なサービスの起動確認

以下のサービスが起動していることを確認してください：

```bash
# PostgreSQL と Redis が起動しているか確認
docker-compose ps

# 起動していない場合は以下を実行
docker-compose up -d postgres redis
```

### 2. バックエンドサーバーの起動

**方法1: 環境変数ファイルを作成（推奨）**

```bash
# バックエンドディレクトリに移動
cd backend

# .env ファイルを作成
cat > .env << EOF
DB_HOST=localhost
DB_PORT=5432
DB_USER=postgres
DB_PASSWORD=password
DB_NAME=chatapp
REDIS_HOST=localhost
REDIS_PORT=6379
JWT_SECRET=test-secret-key
EOF

# サーバー起動
./main
```

**方法2: コマンドラインで直接指定**

```bash
# バックエンドディレクトリに移動
cd backend

# 環境変数を設定してサーバー起動
DB_HOST=localhost \
DB_PORT=5432 \
DB_USER=postgres \
DB_PASSWORD=password \
DB_NAME=chatapp \
REDIS_HOST=localhost \
REDIS_PORT=6379 \
JWT_SECRET=test-secret-key \
./main
```

**方法3: 既存の.env.exampleを使用**

```bash
# バックエンドディレクトリに移動
cd backend

# .env.example を .env にコピー
cp ../.env.example .env

# 必要に応じて .env ファイルを編集
# サーバー起動
./main
```

**確認方法:**
- ターミナルに `Server starting on port 8080` と表示される
- http://localhost:8080/health にアクセスして `{"status":"ok"}` が返される

**💡 ヒント:** 
- `.env` ファイルは `backend/` ディレクトリ内に作成してください
- 既に `.env` ファイルが存在する場合は、上記の値に更新してください
- 環境変数が正しく読み込まれているかは、サーバー起動時のログで確認できます

### 3. フロントエンドサーバーの起動

```bash
# 新しいターミナルウィンドウを開く
cd frontend

# 開発サーバー起動
npm run dev
```

**確認方法:**
- ターミナルに `Ready in XXXms` と表示される
- http://localhost:3000 にアクセスできる

## 🧪 ブラウザテスト手順

### ステップ1: アプリケーションへのアクセス

1. ブラウザで http://localhost:3000 を開く
2. 自動的にログインページ（/login）にリダイレクトされることを確認

### ステップ2: ユーザー登録

1. **「Sign up」をクリック**
2. **以下の情報を入力:**
   - Username: `testuser1`
   - Email: `testuser1@example.com`
   - Password: `password123`
3. **「Sign up」ボタンをクリック**
4. **期待される結果:**
   - 自動的にチャンネル一覧ページ（/channels）に移動
   - 右上に「Welcome, testuser1」と表示される

### ステップ3: チャンネルへの参加

1. **「general」チャンネルカードをクリック**
2. **期待される結果:**
   - チャット画面（/chat/general）に移動
   - 画面上部に「# general」と表示される
   - 接続状態インジケーターが緑色（Connected）になる

### ステップ4: メッセージ送信テスト

1. **画面下部のメッセージ入力欄に「Hello, World!」と入力**
2. **Enterキーを押すか送信ボタンをクリック**
3. **期待される結果:**
   - メッセージが即座にチャット画面に表示される
   - メッセージの右側に自分のメッセージとして表示される
   - タイムスタンプが表示される

### ステップ5: 複数ユーザーテスト（推奨）

**新しいブラウザウィンドウまたはシークレットモードで:**

1. **http://localhost:3000 を開く**
2. **新しいユーザーを登録:**
   - Username: `testuser2`
   - Email: `testuser2@example.com`
   - Password: `password123`
3. **generalチャンネルに参加**
4. **メッセージを送信: 「Hi from user 2!」**
5. **期待される結果:**
   - 両方のブラウザウィンドウでリアルタイムにメッセージが表示される
   - 他のユーザーのメッセージは左側に表示される
   - ユーザー名とアバターが表示される

## 🔍 テスト項目チェックリスト

### 認証機能
- [ ] ユーザー登録が正常に動作する
- [ ] ログインが正常に動作する
- [ ] ログアウトが正常に動作する
- [ ] 未認証時に自動的にログインページにリダイレクトされる

### チャット機能
- [ ] メッセージ送信が正常に動作する
- [ ] リアルタイムでメッセージが受信される
- [ ] メッセージ履歴が正しく表示される
- [ ] 長いメッセージが適切に表示される
- [ ] 改行を含むメッセージが正しく表示される

### UI/UX
- [ ] レスポンシブデザインが機能する（画面サイズを変更してテスト）
- [ ] ローディング状態が適切に表示される
- [ ] エラーメッセージが適切に表示される
- [ ] 接続状態インジケーターが正しく動作する

### WebSocket接続
- [ ] ページ読み込み時に自動接続される
- [ ] 接続が切れた場合の表示が適切
- [ ] 複数タブで開いても正常に動作する

## 🐛 トラブルシューティング

### よくある問題と解決方法

**1. ページが表示されない**
```bash
# フロントエンドサーバーが起動しているか確認
curl http://localhost:3000
```

**2. API接続エラー**
```bash
# バックエンドサーバーが起動しているか確認
curl http://localhost:8080/health
```

**3. WebSocket接続エラー**
```bash
# ブラウザの開発者ツール（F12）でConsoleタブを確認
# WebSocket関連のエラーメッセージをチェック
```

**4. データベース接続エラー**
```bash
# PostgreSQLコンテナが起動しているか確認
docker-compose ps postgres

# 必要に応じて再起動
docker-compose restart postgres
```

**5. 既存ユーザーエラー**
- 同じメールアドレスで複数回登録しようとするとエラーになります
- 異なるメールアドレスを使用するか、ログイン機能を使用してください

## 📱 モバイルテスト

スマートフォンでのテストも可能です：

1. **同じネットワーク内のスマートフォンから:**
   - PCのIPアドレスを確認: `ipconfig` (Windows) または `ifconfig` (Mac/Linux)
   - スマートフォンのブラウザで `http://[PCのIPアドレス]:3000` にアクセス

2. **期待される結果:**
   - モバイル画面に最適化されたレイアウトで表示される
   - タッチ操作でメッセージ送信が可能

## 🎯 テスト完了後

テストが完了したら：

1. **サーバーを停止:**
   ```bash
   # フロントエンド: Ctrl+C
   # バックエンド: Ctrl+C
   ```

2. **Dockerコンテナを停止（必要に応じて）:**
   ```bash
   docker-compose down
   ```

## 📝 フィードバック

テスト中に発見した問題や改善点があれば記録してください：
- UI/UXの改善点
- パフォーマンスの問題
- 機能の追加要望
- バグレポート

---

**🎉 Happy Testing!** 

何か問題が発生した場合は、ブラウザの開発者ツール（F12）でConsoleとNetworkタブを確認し、エラーメッセージを参考にしてください。